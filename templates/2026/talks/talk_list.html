{% extends "base.html" %}
{% load i18n static avatar_tags %}
{% block meta_title %}{% if page %}{{ page.meta_title }}{% else %}{% trans "Submitted Talks || PyCon Africa 2026" %}{% endif %}{% endblock %}

{% block extra_css %}
<style>
  .profile-nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.75rem;
    color: #374151;
    text-decoration: none;
    border-radius: 0.5rem;
    font-size: 0.9375rem;
  }
  @media (max-width: 640px) {
    .profile-nav-link {
      padding: 0.75rem;
      font-size: 0.875rem;
    }
  }
  .profile-nav-link:hover {
    background: #f3f4f6;
    color: #111827;
  }
  .profile-nav-link.active {
    background: #0d9488;
    color: #fff;
  }
  .profile-nav-link.active:hover {
    background: #0f766e;
    color: #fff;
  }
</style>
{% endblock %}

{% block content %}
{% include '2026/navbar.html' %}

<div class="auth-page-content min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-3 sm:py-4 sm:px-6 lg:px-8">
      <nav aria-label="breadcrumb" class="mb-1.5 sm:mb-2">
        <ol class="flex flex-wrap items-center gap-1 text-xs sm:text-sm text-gray-500 list-none p-0 m-0">
          <li><a class="text-pycon-teal hover:underline" href="/2026/">{% trans "Home" %}</a></li>
          <li><span class="text-gray-400" aria-hidden="true">/</span></li>
          <li><a class="text-pycon-teal hover:underline" href="/accounts/profile/">{% trans "Profile" %}</a></li>
          <li><span class="text-gray-400" aria-hidden="true">/</span></li>
          <li class="text-gray-700" aria-current="page">{% trans "My Submitted Talks" %}</li>
        </ol>
      </nav>
      <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900">
        {% if user_profile %}{{ request.user.user_profile.name }}{% else %}{% firstof user.get_short_name user.get_username|capfirst %}{% endif %} – {% trans "Proposals" %}
      </h1>
    </div>
  </header>

  <section class="max-w-6xl mx-auto px-4 py-6 sm:py-8 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row gap-6 lg:gap-10">
      <!-- Sidebar -->
      <aside class="w-full md:w-64 shrink-0 md:order-1 order-2">
        <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden md:sticky md:top-24">
          <div class="p-4 sm:p-5">
            <div class="mb-4 flex justify-center">
              <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full overflow-hidden border-2 border-gray-100 shadow-sm [&_img]:w-full [&_img]:h-full [&_img]:object-cover">
                {% include 'profiles/profilepic_side.html' %}
              </div>
            </div>
            {% if request.user.last_login %}
            <div class="text-xs text-gray-500 mb-4 pb-4 border-b border-gray-100">
              <span class="font-medium text-gray-400 uppercase tracking-wide">{% trans "Last login" %}</span><br>
              <span class="text-gray-600">{{ request.user.last_login|date:"M. j, Y" }} · {{ request.user.last_login|time:"g:i a" }}</span>
            </div>
            {% endif %}
            <nav class="flex flex-col gap-0.5" aria-label="Profile menu">
              <a href="/accounts/profile/" class="profile-nav-link">
                <i class="fa-solid fa-house w-4 text-center" aria-hidden="true"></i>
                <span>My Profile</span>
              </a>
              <a href="{% url 'profiles:profile_update' pk=request.user.user_profile.profile_id.hashid %}" class="profile-nav-link">
                <i class="fa-solid fa-id-card w-4 text-center" aria-hidden="true"></i>
                <span>Update my Profile</span>
              </a>
              <a href="/accounts/password/change/" class="profile-nav-link">
                <i class="fa-solid fa-lock w-4 text-center" aria-hidden="true"></i>
                <span>Change Password</span>
              </a>
              <a href="{% url 'talks:talk_list' year=year %}" class="profile-nav-link active">
                <i class="fa-solid fa-microphone w-4 text-center" aria-hidden="true"></i>
                <span>My Submitted Talks</span>
              </a>
              <a href="{% url 'talks:submit_talk' year=year %}" class="profile-nav-link">
                <i class="fa-solid fa-podium w-4 text-center" aria-hidden="true"></i>
                <span>Submit a new Talk</span>
              </a>
              {% if perms.reviews.add_review or request.user.reviewer_profile or request.user.is_superuser %}
              <a href="{% url 'talks:talks_to_review' year=year %}" class="profile-nav-link">
                <i class="fa-solid fa-list-check w-4 text-center" aria-hidden="true"></i>
                <span>Review Proposals</span>
              </a>
              {% endif %}
              {% if request.user.is_superuser or request.user.reviewer_profile %}
              <a href="{% url 'talks:reviewed_talks_by_category' year=year %}" class="profile-nav-link">
                <i class="fa-solid fa-clipboard-list w-4 text-center" aria-hidden="true"></i>
                <span>Proposals by Category</span>
              </a>
              {% endif %}
            </nav>
          </div>
        </div>
      </aside>

      <!-- Main content -->
      <div class="flex-1 min-w-0 md:order-2 order-1">
        <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden p-4 sm:p-6 lg:px-8">
          {% if submitted_talks %}
          <div class="mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-900">{% trans "Your submitted talks" %}</h2>
            <p class="mt-1 text-sm text-gray-600">
              {% trans "Here you can review the status of your proposals and edit them when editing is allowed." %}
            </p>
          </div>

          <div class="overflow-x-auto -mx-2 sm:mx-0">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-3 sm:px-4 py-2 text-left font-semibold text-gray-700 text-xs sm:text-sm">
                    {% trans "Title" %}
                  </th>
                  <th scope="col" class="px-3 sm:px-4 py-2 text-left font-semibold text-gray-700 text-xs sm:text-sm">
                    {% trans "Session" %}
                  </th>
                  <th scope="col" class="px-3 sm:px-4 py-2 text-left font-semibold text-gray-700 text-xs sm:text-sm">
                    {% trans "Audience" %}
                  </th>
                  <th scope="col" class="px-3 sm:px-4 py-2 text-left font-semibold text-gray-700 text-xs sm:text-sm">
                    {% trans "Status" %}
                  </th>
                  <th scope="col" class="px-3 sm:px-4 py-2 text-left font-semibold text-gray-700 text-xs sm:text-sm">
                    {% trans "Actions" %}
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100 bg-white">
                {% for talk in submitted_talks %}
                <tr class="hover:bg-gray-50">
                  <td class="px-3 sm:px-4 py-2.5 align-top">
                    <a href="{% url 'talks:talk_details' year=year pk=talk.pk %}"
                       class="text-sm font-medium text-pycon-teal hover:underline">
                      {{ talk.title }}
                    </a>
                  </td>
                  <td class="px-3 sm:px-4 py-2.5 align-top text-gray-700">
                    <span class="text-xs sm:text-sm">{{ talk.talk_type }}</span>
                  </td>
                  <td class="px-3 sm:px-4 py-2.5 align-top text-gray-700">
                    <span class="text-xs sm:text-sm">{{ talk.intended_audience }}</span>
                  </td>
                  <td class="px-3 sm:px-4 py-2.5 align-top">
                    {% if talk.status == "S" %}
                      <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800">
                        {% trans "Under review" %}
                      </span>
                    {% elif talk.status == "A" %}
                      <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-800">
                        {% trans "Accepted" %}
                      </span>
                    {% elif talk.status == "W" %}
                      <span class="inline-flex items-center rounded-full bg-sky-100 px-2.5 py-0.5 text-xs font-medium text-sky-800">
                        {% trans "On waitlist" %}
                      </span>
                    {% elif talk.status == "R" %}
                      <span class="inline-flex items-center rounded-full bg-rose-100 px-2.5 py-0.5 text-xs font-medium text-rose-800">
                        {% trans "Didn't make the cut" %}
                      </span>
                    {% elif talk.status == "RS" %}
                      <span class="inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800">
                        {% trans "You declined to present" %}
                      </span>
                    {% endif %}
                  </td>
                  <td class="px-3 sm:px-4 py-2.5 align-top">
                    <div class="flex flex-wrap gap-2">
                      <a href="{% url 'talks:talk_details' year=year pk=talk.pk %}"
                         class="inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
                        <i class="fa-solid fa-eye w-4 text-center mr-1.5" aria-hidden="true"></i>
                        <span>{% trans "View" %}</span>
                      </a>
                      {% if active_period or talk.user_response == 'A' %}
                      <a href="{% url 'talks:edit_talk' year=year pk=talk.pk %}"
                         class="inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-lg bg-pycon-teal text-white hover:bg-teal-700">
                        <i class="fa-solid fa-pen w-4 text-center mr-1.5" aria-hidden="true"></i>
                        <span>{% trans "Edit" %}</span>
                      </a>
                      {% else %}
                      <span class="inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed"
                            title="{% trans 'You cannot edit the talk because the CFP period is over' %}">
                        <i class="fa-solid fa-pen w-4 text-center mr-1.5" aria-hidden="true"></i>
                        <span>{% trans "Edit" %}</span>
                      </span>
                      {% endif %}
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% else %}
          <div class="flex flex-col items-center text-center">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-2">
              {% trans "You have not submitted any talks yet" %}
            </h2>
            <p class="text-sm sm:text-base text-gray-600 mb-4">
              {% trans "When you submit proposals, they will appear here. Start by creating your first talk proposal." %}
            </p>
            <a href="{% url 'talks:submit_talk' year=year %}"
               class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-semibold rounded-lg bg-pycon-teal text-white hover:bg-teal-700 shadow-sm hover:shadow">
              <i class="fa-solid fa-podium w-4 text-center mr-2" aria-hidden="true"></i>
              <span>{% trans "Submit a new Talk" %}</span>
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
</div>

{% endblock %}

